!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("html2canvas"),require("lay-excel")):"function"==typeof define&&define.amd?define(["exports","vue","html2canvas","lay-excel"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Gantt={},e.Vue,e.html2canvas,e["lay-excel"])}(this,(function(e,t,r,n){"use strict";var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var o=function(){this.__data__=[],this.size=0};var c=function(e,t){return e===t||e!=e&&t!=t},l=c;var i=function(e,t){for(var r=e.length;r--;)if(l(e[r][0],t))return r;return-1},s=i,u=Array.prototype.splice;var d=i;var f=i;var p=i;var y=o,h=function(e){var t=this.__data__,r=s(t,e);return!(r<0)&&(r==t.length-1?t.pop():u.call(t,r,1),--this.size,!0)},v=function(e){var t=this.__data__,r=d(t,e);return r<0?void 0:t[r][1]},g=function(e){return f(this.__data__,e)>-1},m=function(e,t){var r=this.__data__,n=p(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function b(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}b.prototype.clear=y,b.prototype.delete=h,b.prototype.get=v,b.prototype.has=g,b.prototype.set=m;var j=b,w=j;var _=function(){this.__data__=new w,this.size=0};var x=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var k=function(e){return this.__data__.get(e)};var E=function(e){return this.__data__.has(e)},S="object"==typeof a&&a&&a.Object===Object&&a,$=S,O="object"==typeof self&&self&&self.Object===Object&&self,A=$||O||Function("return this")(),C=A.Symbol,D=C,T=Object.prototype,F=T.hasOwnProperty,N=T.toString,B=D?D.toStringTag:void 0;var M=function(e){var t=F.call(e,B),r=e[B];try{e[B]=void 0;var n=!0}catch(o){}var a=N.call(e);return n&&(t?e[B]=r:delete e[B]),a},z=Object.prototype.toString;var I=M,W=function(e){return z.call(e)},P=C?C.toStringTag:void 0;var R=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":P&&P in Object(e)?I(e):W(e)};var V=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},L=R,U=V;var q,H=function(e){if(!U(e))return!1;var t=L(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Y=A["__core-js_shared__"],G=(q=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"";var Z=function(e){return!!G&&G in e},J=Function.prototype.toString;var X=function(e){if(null!=e){try{return J.call(e)}catch(t){}try{return e+""}catch(t){}}return""},K=H,Q=Z,ee=V,te=X,re=/^\[object .+?Constructor\]$/,ne=Function.prototype,ae=Object.prototype,oe=ne.toString,ce=ae.hasOwnProperty,le=RegExp("^"+oe.call(ce).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ie=function(e){return!(!ee(e)||Q(e))&&(K(e)?le:re).test(te(e))},se=function(e,t){return null==e?void 0:e[t]};var ue=function(e,t){var r=se(e,t);return ie(r)?r:void 0},de=ue(A,"Map"),fe=ue(Object,"create"),pe=fe;var ye=function(){this.__data__=pe?pe(null):{},this.size=0};var he=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ve=fe,ge=Object.prototype.hasOwnProperty;var me=function(e){var t=this.__data__;if(ve){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return ge.call(t,e)?t[e]:void 0},be=fe,je=Object.prototype.hasOwnProperty;var we=fe;var _e=ye,xe=he,ke=me,Ee=function(e){var t=this.__data__;return be?void 0!==t[e]:je.call(t,e)},Se=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=we&&void 0===t?"__lodash_hash_undefined__":t,this};function $e(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}$e.prototype.clear=_e,$e.prototype.delete=xe,$e.prototype.get=ke,$e.prototype.has=Ee,$e.prototype.set=Se;var Oe=$e,Ae=j,Ce=de;var De=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Te=function(e,t){var r=e.__data__;return De(t)?r["string"==typeof t?"string":"hash"]:r.map},Fe=Te;var Ne=Te;var Be=Te;var Me=Te;var ze=function(){this.size=0,this.__data__={hash:new Oe,map:new(Ce||Ae),string:new Oe}},Ie=function(e){var t=Fe(this,e).delete(e);return this.size-=t?1:0,t},We=function(e){return Ne(this,e).get(e)},Pe=function(e){return Be(this,e).has(e)},Re=function(e,t){var r=Me(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Ve(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ve.prototype.clear=ze,Ve.prototype.delete=Ie,Ve.prototype.get=We,Ve.prototype.has=Pe,Ve.prototype.set=Re;var Le=j,Ue=de,qe=Ve;var He=j,Ye=_,Ge=x,Ze=k,Je=E,Xe=function(e,t){var r=this.__data__;if(r instanceof Le){var n=r.__data__;if(!Ue||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new qe(n)}return r.set(e,t),this.size=r.size,this};function Ke(e){var t=this.__data__=new He(e);this.size=t.size}Ke.prototype.clear=Ye,Ke.prototype.delete=Ge,Ke.prototype.get=Ze,Ke.prototype.has=Je,Ke.prototype.set=Xe;var Qe=Ke;var et=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},tt=ue,rt=function(){try{var e=tt(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();var nt=function(e,t,r){"__proto__"==t&&rt?rt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},at=nt,ot=c,ct=Object.prototype.hasOwnProperty;var lt=function(e,t,r){var n=e[t];ct.call(e,t)&&ot(n,r)&&(void 0!==r||t in e)||at(e,t,r)},it=lt,st=nt;var ut=function(e,t,r,n){var a=!r;r||(r={});for(var o=-1,c=t.length;++o<c;){var l=t[o],i=n?n(r[l],e[l],l,r,e):void 0;void 0===i&&(i=e[l]),a?st(r,l,i):it(r,l,i)}return r};var dt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var ft=function(e){return null!=e&&"object"==typeof e},pt=R,yt=ft;var ht,vt,gt,mt,bt,jt,wt,_t,xt=function(e){return yt(e)&&"[object Arguments]"==pt(e)},kt=ft,Et=Object.prototype,St=Et.hasOwnProperty,$t=Et.propertyIsEnumerable,Ot=xt(function(){return arguments}())?xt:function(e){return kt(e)&&St.call(e,"callee")&&!$t.call(e,"callee")},At=Ot,Ct=Array.isArray,Dt={};ht={get exports(){return Dt},set exports(e){Dt=e}},gt=A,mt=function(){return!1},bt=(vt=Dt)&&!vt.nodeType&&vt,jt=bt&&ht&&!ht.nodeType&&ht,wt=jt&&jt.exports===bt?gt.Buffer:void 0,_t=(wt?wt.isBuffer:void 0)||mt,ht.exports=_t;var Tt=/^(?:0|[1-9]\d*)$/;var Ft=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Tt.test(e))&&e>-1&&e%1==0&&e<t};var Nt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Bt=R,Mt=Nt,zt=ft,It={};It["[object Float32Array]"]=It["[object Float64Array]"]=It["[object Int8Array]"]=It["[object Int16Array]"]=It["[object Int32Array]"]=It["[object Uint8Array]"]=It["[object Uint8ClampedArray]"]=It["[object Uint16Array]"]=It["[object Uint32Array]"]=!0,It["[object Arguments]"]=It["[object Array]"]=It["[object ArrayBuffer]"]=It["[object Boolean]"]=It["[object DataView]"]=It["[object Date]"]=It["[object Error]"]=It["[object Function]"]=It["[object Map]"]=It["[object Number]"]=It["[object Object]"]=It["[object RegExp]"]=It["[object Set]"]=It["[object String]"]=It["[object WeakMap]"]=!1;var Wt=function(e){return zt(e)&&Mt(e.length)&&!!It[Bt(e)]};var Pt=function(e){return function(t){return e(t)}},Rt={};!function(e,t){var r=S,n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,o=a&&a.exports===n&&r.process,c=function(){try{var e=a&&a.require&&a.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=c}({get exports(){return Rt},set exports(e){Rt=e}},Rt);var Vt=Wt,Lt=Pt,Ut=Rt&&Rt.isTypedArray,qt=Ut?Lt(Ut):Vt,Ht=dt,Yt=At,Gt=Ct,Zt=Dt,Jt=Ft,Xt=qt,Kt=Object.prototype.hasOwnProperty;var Qt=function(e,t){var r=Gt(e),n=!r&&Yt(e),a=!r&&!n&&Zt(e),o=!r&&!n&&!a&&Xt(e),c=r||n||a||o,l=c?Ht(e.length,String):[],i=l.length;for(var s in e)!t&&!Kt.call(e,s)||c&&("length"==s||a&&("offset"==s||"parent"==s)||o&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Jt(s,i))||l.push(s);return l},er=Object.prototype;var tr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||er)};var rr=function(e,t){return function(r){return e(t(r))}},nr=rr(Object.keys,Object),ar=tr,or=nr,cr=Object.prototype.hasOwnProperty;var lr=H,ir=Nt;var sr=function(e){return null!=e&&ir(e.length)&&!lr(e)},ur=Qt,dr=function(e){if(!ar(e))return or(e);var t=[];for(var r in Object(e))cr.call(e,r)&&"constructor"!=r&&t.push(r);return t},fr=sr;var pr=function(e){return fr(e)?ur(e):dr(e)},yr=ut,hr=pr;var vr=function(e,t){return e&&yr(t,hr(t),e)};var gr=V,mr=tr,br=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},jr=Object.prototype.hasOwnProperty;var wr=Qt,_r=function(e){if(!gr(e))return br(e);var t=mr(e),r=[];for(var n in e)("constructor"!=n||!t&&jr.call(e,n))&&r.push(n);return r},xr=sr;var kr=function(e){return xr(e)?wr(e,!0):_r(e)},Er=ut,Sr=kr;var $r=function(e,t){return e&&Er(t,Sr(t),e)},Or={};!function(e,t){var r=A,n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,o=a&&a.exports===n?r.Buffer:void 0,c=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=c?c(r):new e.constructor(r);return e.copy(n),n}}({get exports(){return Or},set exports(e){Or=e}},Or);var Ar=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t};var Cr=function(){return[]},Dr=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,o=[];++r<n;){var c=e[r];t(c,r,e)&&(o[a++]=c)}return o},Tr=Cr,Fr=Object.prototype.propertyIsEnumerable,Nr=Object.getOwnPropertySymbols,Br=Nr?function(e){return null==e?[]:(e=Object(e),Dr(Nr(e),(function(t){return Fr.call(e,t)})))}:Tr,Mr=ut,zr=Br;var Ir=function(e,t){return Mr(e,zr(e),t)};var Wr=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},Pr=rr(Object.getPrototypeOf,Object),Rr=Wr,Vr=Pr,Lr=Br,Ur=Cr,qr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Rr(t,Lr(e)),e=Vr(e);return t}:Ur,Hr=ut,Yr=qr;var Gr=function(e,t){return Hr(e,Yr(e),t)},Zr=Wr,Jr=Ct;var Xr=function(e,t,r){var n=t(e);return Jr(e)?n:Zr(n,r(e))},Kr=Xr,Qr=Br,en=pr;var tn=function(e){return Kr(e,en,Qr)},rn=Xr,nn=qr,an=kr;var on=function(e){return rn(e,an,nn)},cn=ue(A,"DataView"),ln=de,sn=ue(A,"Promise"),un=ue(A,"Set"),dn=ue(A,"WeakMap"),fn=R,pn=X,yn="[object Map]",hn="[object Promise]",vn="[object Set]",gn="[object WeakMap]",mn="[object DataView]",bn=pn(cn),jn=pn(ln),wn=pn(sn),_n=pn(un),xn=pn(dn),kn=fn;(cn&&kn(new cn(new ArrayBuffer(1)))!=mn||ln&&kn(new ln)!=yn||sn&&kn(sn.resolve())!=hn||un&&kn(new un)!=vn||dn&&kn(new dn)!=gn)&&(kn=function(e){var t=fn(e),r="[object Object]"==t?e.constructor:void 0,n=r?pn(r):"";if(n)switch(n){case bn:return mn;case jn:return yn;case wn:return hn;case _n:return vn;case xn:return gn}return t});var En=kn,Sn=Object.prototype.hasOwnProperty;var $n=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Sn.call(e,"index")&&(r.index=e.index,r.input=e.input),r},On=A.Uint8Array;var An=function(e){var t=new e.constructor(e.byteLength);return new On(t).set(new On(e)),t},Cn=An;var Dn=function(e,t){var r=t?Cn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},Tn=/\w*$/;var Fn=function(e){var t=new e.constructor(e.source,Tn.exec(e));return t.lastIndex=e.lastIndex,t},Nn=C?C.prototype:void 0,Bn=Nn?Nn.valueOf:void 0;var Mn=An;var zn=An,In=Dn,Wn=Fn,Pn=function(e){return Bn?Object(Bn.call(e)):{}},Rn=function(e,t){var r=t?Mn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Vn=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return zn(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return In(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Rn(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Wn(e);case"[object Symbol]":return Pn(e)}},Ln=V,Un=Object.create,qn=function(){function e(){}return function(t){if(!Ln(t))return{};if(Un)return Un(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Hn=Pr,Yn=tr;var Gn=function(e){return"function"!=typeof e.constructor||Yn(e)?{}:qn(Hn(e))},Zn=En,Jn=ft;var Xn=function(e){return Jn(e)&&"[object Map]"==Zn(e)},Kn=Pt,Qn=Rt&&Rt.isMap,ea=Qn?Kn(Qn):Xn,ta=En,ra=ft;var na=function(e){return ra(e)&&"[object Set]"==ta(e)},aa=Pt,oa=Rt&&Rt.isSet,ca=oa?aa(oa):na,la=Qe,ia=et,sa=lt,ua=vr,da=$r,fa=Or,pa=Ar,ya=Ir,ha=Gr,va=tn,ga=on,ma=En,ba=$n,ja=Vn,wa=Gn,_a=Ct,xa=Dt,ka=ea,Ea=V,Sa=ca,$a=pr,Oa=kr,Aa="[object Arguments]",Ca="[object Function]",Da="[object Object]",Ta={};Ta[Aa]=Ta["[object Array]"]=Ta["[object ArrayBuffer]"]=Ta["[object DataView]"]=Ta["[object Boolean]"]=Ta["[object Date]"]=Ta["[object Float32Array]"]=Ta["[object Float64Array]"]=Ta["[object Int8Array]"]=Ta["[object Int16Array]"]=Ta["[object Int32Array]"]=Ta["[object Map]"]=Ta["[object Number]"]=Ta[Da]=Ta["[object RegExp]"]=Ta["[object Set]"]=Ta["[object String]"]=Ta["[object Symbol]"]=Ta["[object Uint8Array]"]=Ta["[object Uint8ClampedArray]"]=Ta["[object Uint16Array]"]=Ta["[object Uint32Array]"]=!0,Ta["[object Error]"]=Ta[Ca]=Ta["[object WeakMap]"]=!1;var Fa=function e(t,r,n,a,o,c){var l,i=1&r,s=2&r,u=4&r;if(n&&(l=o?n(t,a,o,c):n(t)),void 0!==l)return l;if(!Ea(t))return t;var d=_a(t);if(d){if(l=ba(t),!i)return pa(t,l)}else{var f=ma(t),p=f==Ca||"[object GeneratorFunction]"==f;if(xa(t))return fa(t,i);if(f==Da||f==Aa||p&&!o){if(l=s||p?{}:wa(t),!i)return s?ha(t,da(l,t)):ya(t,ua(l,t))}else{if(!Ta[f])return o?t:{};l=ja(t,f,i)}}c||(c=new la);var y=c.get(t);if(y)return y;c.set(t,l),Sa(t)?t.forEach((function(a){l.add(e(a,r,n,a,t,c))})):ka(t)&&t.forEach((function(a,o){l.set(o,e(a,r,n,o,t,c))}));var h=d?void 0:(u?s?ga:va:s?Oa:$a)(t);return ia(h||t,(function(a,o){h&&(a=t[o=a]),sa(l,o,e(a,r,n,o,t,c))})),l},Na=Fa;var Ba=function(e){return Na(e,5)};const Ma=(e,t=null)=>{let r=e;return"string"==typeof t&&(r=Wa(e,t)),r.map((e=>za(e)))},za=e=>{let t=null;"string"==typeof e?t=new Date(e):e instanceof Date&&(t=e);return{year:String(t.getFullYear()).padStart(4,"0"),month:String(t.getMonth()+1).padStart(2,"0"),day:String(t.getDate()).padStart(2,"0"),week:["日","一","二","三","四","五","六"][t.getDay()]}},Ia=e=>{const t=e.replace(/\//g,"-").split("-").map((e=>Number(e)));if(2!==t.length)throw new Error("获取月份日期参数错误:",e);const r=new Date(...t,0).getDate();return new Array(r).fill().map(((e,t)=>t+1))},Wa=(e,t)=>{const r=new Date(e.replace(/\//g,"-")),n=new Date(t),a=[];for(;n>=r;){const e=za(r);a.push(`${e.year}-${e.month}-${e.day}`),r.setDate(r.getDate()+1)}return a},Pa=e=>{const t={};return e.forEach((e=>{const r=e.year+"-"+e.month;t[r]?t[r].push(e):t[r]=[e]})),Object.values(t)},Ra=(e,t)=>Wa(...t).includes(e),Va=e=>{const t=String(e).replace("/","-").split("-");return Ia(e).map((e=>String(t[0]).padStart(4,"0")+"-"+String(t[1]).padStart(2,"0")+"-"+String(e).padStart(2,"0")))},La=()=>{const e=new Date;return`${String(e.getFullYear()).padStart(4,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},Ua=(e=new Date)=>{const t=e.getFullYear(),r=e.getMonth()+1,n=`${t}-${String(r).padStart(2,"0")}`;let a="";a=1===r?`${String(t-1).padStart(4,"0")}-12`:`${String(t).padStart(4,"0")}-${String(r-1).padStart(2,"0")}`;let o="";o=12===r?`${String(t+1).padStart(4,"0")}-01`:`${String(t).padStart(4,"0")}-${String(r+1).padStart(2,"0")}`;const c=Va(a),l=Va(n),i=Va(o);let s=[...c,...l,...i];return s.prev=c,s.current=l,s.next=i,s},qa=(e,t)=>e.map((e=>{if("normal"!==e.type)return e;const r=(e=>{if(!e.length)return{};const t=e[0].days[0],r=e.map((e=>new Date(e.days.at(-1)).getTime())).sort(((e,t)=>e-t)).at(-1),n=za(new Date(r)),a=`${n.year}-${n.month}-${n.day}`,o={};return Wa(t,a).forEach((t=>{const r=e.map(((e,r)=>!!e.days.includes(t)&&r)).filter((e=>!1!==e));r.length&&(o[t]=r)})),o})(e.schedule),n=Object.values(r),a=Object.keys(r);if(!a.length)return e;const o=[];for(let t=0;t<n.length;t++)JSON.stringify(o.at(-1))!==JSON.stringify(n[t])?(o.push(n[t]),o.at(-1).days=[a[t]]):o.at(-1)&&(o.at(-1).days?o.at(-1).days.push(a[t]):o.at(-1).days=[a[t]]);let c=new Array(o.length).fill({});return c=c.map(((r,n)=>{let a={};if(1===o[n].length){if(a={...e.schedule[o[n][0]],days:o[n].days,daysSource:e.schedule[o[n][0]].days},a.list){let e="",r="";e="function"==typeof t.desc?t.desc(a.list):t.desc,r="function"==typeof t.name?t.name(a.list):t.name,a={...a,desc:e,name:r,backgroundColor:t.backgroundColor,textColor:t.textColor}}}else{const r=o[n].map((t=>e.schedule[t]));let c="",l="";c="function"==typeof t.desc?t.desc(r):t.desc,l="function"==typeof t.name?t.name(r):t.name,a={desc:c,backgroundColor:t.backgroundColor,textColor:t.textColor,name:l,list:r,days:o[n].days}}return a})),e.schedule=c,e}));var Ha=function(e){var t=0,r=e.match(/./g),n=0,a=e.length-1;for(n=1;a>=0;a--,n*=26){var o=r[a].toUpperCase();if(o<"A"||o>"Z")return 0;t+=(o.charCodeAt(0)-64)*n}return t},Ya=function(e){for(var t="";e>0;){var r=e%26;0==r&&(r=26),t=String.fromCharCode(r+64)+t,e=(e-r)/26}return t};const Ga=e=>{if(6===e.length)return e;if(3===e.length){const t=e.split("");return`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`}throw new Error(`转换色值格式错误:${e}`)};const Za={class:"guide"},Ja={class:"desc"},Xa={class:"date"},Ka={class:"item"},Qa={class:"item-name-list"},eo={class:"date-list first-date-list"},to={class:"month"},ro={class:"day-box"},no={class:"day"},ao={class:"week"},oo={class:"schedule-box"},co=["title","onMousemove","onMouseout","onClick"],lo={key:0,class:"work-desc"},io=((e,t)=>{const r=e.__vccOpts||e;for(const[n,a]of t)r[n]=a;return r})({__name:"Gantt",props:{data:{type:Array,required:!0,default:[]},dateRangeList:{type:Array,required:!0,default:[],validator:e=>e[0]&&e.at(-1)},dateText:{type:String,required:!0},itemText:{type:String,required:!0},activeDate:{type:String,default:()=>La()},repeatMode:{type:Object,default:()=>({mode:"cover",backgroundColor:"#FFFFCC",textColor:"#336666",name:"重叠日程",desc:"这是多个日程"})},itemWidth:{type:Number,default:40,validator:e=>e>=40},itemHeight:{type:Number,default:40,validator:e=>e>=40},scheduleTitle:{type:Function,default:null},borderColor:{type:String,default:"#eee"},alikeName:{type:Function,default:null}},emits:["scheduleClick","scrollXEnd","scrollYEnd"],setup(e,{expose:a,emit:o}){const c=e;t.useCssVars((e=>({"39c94b00":c.borderColor,"6c211071":c.itemWidth+"px","62895a5c":c.itemHeight+"px","7593b3c6":i.value,"5ba861e2":s.value})));let l=t.ref([]);const i=t.ref("2000px"),s=t.ref("0px"),u=t.ref();let d=null;const f=()=>{clearTimeout(d),d=setTimeout((()=>{u.value&&(s.value=0,t.nextTick((()=>{const e=u.value.parentElement||document.body,t=u.value.querySelector(".desc").getBoundingClientRect(),r=e.getBoundingClientRect(),n=t.top-r.top;s.value=r.height-t.height-n+"px"})))}),200)};t.onMounted((()=>{const e=u.value.querySelector(".item-name-list"),t=u.value.querySelector(".schedule-box");e.addEventListener("scroll",k),t.addEventListener("scroll",k),window.addEventListener("resize",f),f()})),t.watchEffect((()=>{l.value=Pa(Ma(c.dateRangeList[0],c.dateRangeList.at(-1))),console.log("rangeDate.value",l.value),i.value=c.itemWidth*l.value.flat(1).length+122+"px"}));const p=t.ref([]),y=e=>e.map((e=>("normal"===e.type&&Array.isArray(e.schedule)&&e.schedule.length&&(e.schedule=e.schedule.filter((e=>{const t=l.value[0][0],r=`${t.year}-${t.month}-${t.day}`;return new Date(e.days.at(-1)).getTime()>=new Date(r).getTime()}))),e))),h=()=>{(()=>{const e=["type","name","schedule"],t=["id","name","desc","backgroundColor","textColor","days"];c.data.forEach((r=>{if("normal"===r.type){const n=Object.keys(r),a=e.find((e=>!n.includes(e)));if(a)throw new Error(`项目缺少${a}项`);r.schedule.forEach((e=>{if(!e.list){const r=Object.keys(e),n=t.find((e=>!r.includes(e)));if(n)throw new Error(`日程缺少${n}项`)}}))}}))})(),p.value=Ba(c.data).map((e=>"normal"===e.type&&Array.isArray(e.schedule)?(e.schedule=e.schedule.sort(((e,t)=>new Date(e.days[0]).getTime()-new Date(t.days[0]).getTime())),e.schedule=e.schedule.map((e=>(2===e.days.length&&(e.days=Wa(...e.days)),e))),e):e)),p.value=y(p.value)},v=(e,t)=>{let r={};return"alike"===e.type&&(r={...r,backgroundColor:e.color}),t&&"works"===t.type&&(r={...r,backgroundColor:t.backgroundColor,color:t.textColor,width:t.width+"px",marginLeft:-t.left+"px"}),r},g=(e,t)=>{const r=Ra(e[0],[t[0].date,t[t.length-1].date]),n=Ra(e[e.length-1],[t[0].date,t[t.length-1].date]);if(r&&n)return e.length*c.itemWidth;if(!r&&n)return Wa(t[0].date,e[e.length-1]).length*c.itemWidth;if(r&&!n)return Wa(e[0],t[t.length-1].date).length*c.itemWidth;if(!r&&!n)return Wa(t[0].date,t.at(-1).date).length*c.itemWidth;throw new Error("computeWordwidth 宽度计算异常！")},m=(e,t)=>e.days.filter((e=>t.days.includes(e))),b=(e,t)=>t.find((t=>"works"===t.type&&t.days.includes(e))),j=(e,t)=>{const r=b(e.days[0],t);if(r&&e.id!==r.id){const n=m(r,e),a=e.days.slice(n.length)[0],o=t.findIndex((e=>e.date===a));t[o]={type:"works",date:e.days[0],width:g(e.days,t),left:n.length*c.itemWidth,...e}}else{const r=t.findIndex((t=>t.date===e.days[0]));t[r]={type:"works",date:e.days[0],width:g(e.days,t),left:0,...e}}return t=t.filter((t=>!("normal"===t.type&&e.days.includes(t.date))))},w=e=>{const t=(e=>e.flat(1).map((e=>({type:"normal",date:String(e.year).padStart(4,"0")+"-"+String(e.month).padStart(2,"0")+"-"+String(e.day).padStart(2,"0")}))))(l.value);if(!e.schedule||!e.schedule.length)return t;let r=[];return e.schedule.forEach((e=>{t.forEach((n=>{const a=(o=n.date,e.days.includes(o));var o;const c=((e,t)=>!!t.find((t=>t.date===e)))(n.date,r),l=((e,t)=>!!((e,t)=>!!t.find((t=>t.days.includes(e))))(e,t.filter((e=>"works"===e.type))))(n.date,r);if(a)if(c||l)if(!c&&l){const t=b(n.date,r);e.id!==t.id&&(m(t,e),r=j(e,r))}else c&&!l&&(console.warn("当前日期已经被添加 && 当前日程不在已添加的日程范围内 (新增日程)"),r=j(e,r));else r.push({type:"works",date:n.date,width:g(e.days,t),left:0,...e});else c||l||r.push(n)}))})),r};let _=null;const x=t.ref(null),k=e=>{const t=e?e.target:x.value;if(!t)return;let r="item-name-list";"item-name-list"===t.className&&(r="schedule-box");const n=u.value.querySelector(`.${r}`);n&&(n.scrollTop=t.scrollTop),_&&clearTimeout(_),_=setTimeout((()=>{const r=Math.ceil(Math.max(t.clientHeight,t.scrollHeight));t.scrollTop+t.clientHeight>=r&&o("scrollYEnd",e)}),200)};t.watchEffect((()=>{h(),"extract"===c.repeatMode.mode&&(p.value=qa(p.value,c.repeatMode),p.value=y(p.value)),t.nextTick((()=>{k()}))}));return a({exportImg:async(e={})=>{if("boolean"==typeof e||"object"!=typeof e)throw new Error("exportImg传参方式已更改，请通过Object方式设置导出配置");let{download:n=!0,waterType:a="txt",waterValue:o=""}=e;return new Promise((e=>{const a=document.querySelector(".guide");s.value="unset",u.value.style.maxWidth="unset",x.value.scrollLeft=x.value.scrollWidth,u.value.style.width=x.value.scrollWidth+a.clientWidth+"px",t.nextTick((()=>{o=o.trim();let t=null;if(o){const e=(e=>{let t=20*e.length,r=document.createElement("canvas");r.width=r.height=t;let n=r.getContext("2d");n.font='14px "PingFangSC", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif',n.fillStyle="rgba(0,0,0,0.5)",n.rotate(-25*Math.PI/180),n.fillText(e,t/20,t/2);const a=r.toDataURL("image/png");return r=n=null,a})(o);t=document.createElement("div"),t.style.position="absolute",t.style.zIndex="9999",t.style.opacity="0.1",t.style.top=t.style.left="0",t.style.width=t.style.height="100%",t.style.backgroundImage=`url(${e})`,u.value.appendChild(t)}r(u.value,{removeContainer:!0}).then((function(r){const a=r.toDataURL();if(t&&t.parentNode.removeChild(t),u.value.style.maxWidth=i.value,f(),u.value.style.width="100%",n){const e=document.createElement("a");e.href=a,e.setAttribute("download","日程图"),e.click()}e(a)}))}))}))},exportGanttExcel:e=>{const t=Ba(p.value).map((e=>(e.renderWorks=w(e),"alike"===e.type&&c.alikeName&&(e.name=c.alikeName(e)),"normal"===e.type&&c.scheduleTitle&&e.renderWorks.forEach((e=>{e.name=c.scheduleTitle(e)})),e)));!function(e,t,r,a="",o=""){const{fileName:c="数据"}=e;console.log("导出excel",t,r);let l=[];const i=[{name:`${a}-${o}`},{},{}],s=["name"];let u=[];const d={name:""};t.forEach((e=>{e.forEach((e=>{i[0][`${e.year}-${e.month}-${e.day}`]=`${e.year}-${e.month}`,i[1][`${e.year}-${e.month}-${e.day}`]=e.day,i[2][`${e.year}-${e.month}-${e.day}`]=e.week,s.push(`${e.year}-${e.month}-${e.day}`),d[`${e.year}-${e.month}-${e.day}`]=""}));const t=u.at(-1)?Ya(Ha(u.at(-1).at(-1))):"A",r=Ya(Ha(t)+e.length);u.push([Ya(Ha(t)+1),r])})),u=u.map((e=>e.map((e=>e+1)))),l=l.concat(i);const f=s.length-1;r.forEach((e=>{const t=JSON.parse(JSON.stringify(d));t.name=e.name,t.type=e.type,t.renderWorks=e.renderWorks,l.push(t)}));const p=[],y=[];l.forEach(((e,t)=>{const r=t+1;"alike"===e.type?(p.push([`B${r}`,`${Ya(f+1)}${r}`]),y.push({type:1,backgroundColor:"F6F6F6",range:`A${r}:${Ya(f+1)}${r}`})):e.renderWorks&&e.renderWorks.forEach((e=>{if("works"===e.type){const t=s.findIndex((t=>t===e.days[0])),n=Ya((t<1?1:t)+1),a=s.findIndex((t=>t===e.days.at(-1))),o=Ya((a<1?s.length-1:a)+1);p.push([`${n}${r}`,`${o}${r}`]),y.push({type:1,backgroundColor:e.backgroundColor.replace("#",""),textColor:e.textColor.replace("#",""),range:`${n}${r}:${o}${r}`}),e.days.forEach((t=>{l[r-1][t]=e.name}))}}))}));const h=[["A1","A3"],...u,...p],v=n.filterExportData(l,s),g=n.makeMergeConfig(h),m=n.makeColConfig({A:120,ZZZZ:60},60),b=n.makeRowConfig({1:40,99999:40},40);n.setExportCellStyle(v,null,{s:{alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin",color:{rgb:"E2E4E8"}},left:{style:"thin",color:{rgb:"E2E4E8"}},right:{style:"thin",color:{rgb:"E2E4E8"}},bottom:{style:"thin",color:{rgb:"E2E4E8"}}}}}),y.forEach((e=>{1===e.type&&n.setExportCellStyle(v,e.range,{s:{fill:{bgColor:{indexed:64},fgColor:{rgb:Ga(e.backgroundColor||"FFFFFF")}},font:{color:{rgb:Ga(e.textColor||"000000")}},border:{top:{style:"thin",color:{rgb:"E2E4E8"}},left:{style:"thin",color:{rgb:"E2E4E8"}},right:{style:"thin",color:{rgb:"E2E4E8"}},bottom:{style:"thin",color:{rgb:"E2E4E8"}}},alignment:{horizontal:"center",vertical:"center",wrapText:!0}}})})),n.exportExcel({sheet1:v},`${c}.xlsx`,"xlsx",{extend:{"!cols":m,"!rows":b,"!merges":g}})}(e,l.value,t,c.dateText,c.itemText)}}),(e,r)=>(t.openBlock(),t.createElementBlock("div",{class:"gantt",ref_key:"gantt",ref:u},[t.createElementVNode("div",Za,[t.createElementVNode("div",Ja,[t.createElementVNode("span",Xa,t.toDisplayString(c.dateText),1),t.createElementVNode("span",Ka,t.toDisplayString(c.itemText),1)]),t.createElementVNode("div",Qa,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(p.value,((e,r)=>(t.openBlock(),t.createElementBlock("div",{key:r,class:t.normalizeClass({"guide-name":!0,"last-guide-name":r===p.value.length-1}),style:t.normalizeStyle("alike"===e.type&&v(e))},t.toDisplayString("function"==typeof c.alikeName&&"alike"===e.type?c.alikeName(e):e.name),7)))),128))])]),t.createElementVNode("div",{class:"inner",onScroll:r[0]||(r[0]=e=>{return t=e,_&&clearTimeout(_),void(_=setTimeout((()=>{const e=t.target,r=Math.ceil(Math.max(e.clientWidth,e.scrollWidth));e.scrollLeft+e.clientWidth>=r&&o("scrollXEnd",t)}),200));var t}),ref_key:"innerRef",ref:x},[t.createElementVNode("div",eo,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(l),(e=>(t.openBlock(),t.createElementBlock("div",{key:e.year+"-"+e.month,class:"month-item"},[t.createElementVNode("div",to,t.toDisplayString(e[0].year+"-"+e[0].month),1),t.createElementVNode("div",ro,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e,((e,r)=>(t.openBlock(),t.createElementBlock("div",{key:e.day+e.week,class:t.normalizeClass({"day-item":!0,"first-day-item":0===r,"date-active":c.activeDate===e.year+"-"+e.month+"-"+e.day})},[t.createElementVNode("div",no,t.toDisplayString(e.day),1),t.createElementVNode("div",ao,t.toDisplayString(e.week),1)],2)))),128))])])))),128))]),t.createElementVNode("div",oo,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(p.value,((e,r)=>(t.openBlock(),t.createElementBlock("div",{key:r,class:t.normalizeClass({"date-box":!0,alike:"alike"===e.type})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(w(e),((r,n)=>(t.openBlock(),t.createElementBlock("div",{key:n,class:t.normalizeClass({"date-item":!0,"date-item-work":"works"===r.type,"date-active":r.date===c.activeDate}),style:t.normalizeStyle(v(e,r)),title:"works"===r.type?r.desc:"",onMousemove:e=>((e,t)=>{"works"===e&&("SPAN"===t.target.tagName?(t.target.parentElement.style.zIndex=2,t.target.parentElement.style.boxShadow="0 0 5px 0px rgba(0, 0, 0, 0.2)"):(t.target.style.zIndex=2,t.target.style.boxShadow="0 0 5px 0px rgba(0, 0, 0, 0.2)"))})(r.type,e),onMouseout:e=>((e,t)=>{"works"===e&&("SPAN"===t.target.tagName?(t.target.parentElement.style.zIndex=1,t.target.parentElement.style.boxShadow="none"):(t.target.style.zIndex=1,t.target.style.boxShadow="none"))})(r.type,e),onClick:e=>(e=>{o("scheduleClick",e)})(r)},["works"===r.type?(t.openBlock(),t.createElementBlock("span",lo,t.toDisplayString(c.scheduleTitle?c.scheduleTitle(r):r.name),1)):t.createCommentVNode("",!0)],46,co)))),128))],2)))),128))])],544)],512))}},[["__scopeId","data-v-8ca3b53f"]]);e.computedDaysRange=Ma,e.default=io,e.fetchDayDetail=za,e.fetchMonthRangeDay=Va,e.fetchNextMonthRange=(e=new Date)=>Ua(e).next,e.fetchPrevMonthRange=(e=new Date)=>Ua(e).prev,e.fetchThreeDays=Ua,e.fetchToday=La,e.fetchTodayMonthRange=(e=new Date)=>Ua(e).current,e.fethDays=Ia,e.fethDaysRange=Wa,e.splitDaysForMonth=Pa,e.todayInRange=Ra,e.workListSplitForRepeat=qa,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=gantt.umd.js.map
